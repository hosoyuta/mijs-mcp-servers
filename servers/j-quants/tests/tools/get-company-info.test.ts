/**
 * TASK-0009: get_company_info MCPãƒ„ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
 *
 * ã€ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚ºã€‘: TDD Red Phaseï¼ˆå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä½œæˆï¼‰
 * ã€ä½œæˆæ—¥ã€‘: 2025-10-30
 * ã€ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‘: Vitest 2.1.4
 * ã€è¨€èªã€‘: TypeScript 5.x
 * ã€ç›®çš„ã€‘: ä¼æ¥­æƒ…å ±+æœ€æ–°æ ªä¾¡å–å¾—ãƒ„ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå®Ÿè£…ã¯å­˜åœ¨ã—ãªã„ãŸã‚ã€å…¨ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ï¼‰
 */

import { describe, it, expect, vi, beforeEach } from 'vitest';
import { getCompanyInfo } from '../../src/tools/get-company-info';
import { JQuantsClient } from '../../src/api/j-quants-client';
import { TokenManager } from '../../src/auth/token-manager';
import { Company, StockPrice, Market, Sector } from '../../src/types';
import { ValidationError } from '../../src/utils/validator';

// =========================================
// æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ2ä»¶ï¼‰
// =========================================
describe('get-company-info.ts - æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ä¸€è²«ã—ãŸãƒ†ã‚¹ãƒˆæ¡ä»¶ã‚’ä¿è¨¼
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã€ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ãƒªã‚»ãƒƒãƒˆ
    vi.clearAllMocks();

    // ã€ç’°å¢ƒå¤‰æ•°è¨­å®šã€‘: TokenManagerãŒå¿…è¦ã¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
    process.env.JQUANTS_REFRESH_TOKEN = 'test-refresh-token';

    // ã€TokenManagerãƒ¢ãƒƒã‚¯ã€‘: TokenManagerã®getIdTokenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    // ã€ç†ç”±ã€‘: å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’å›é¿ã—ã€ãƒ†ã‚¹ãƒˆã‚’é«˜é€ŸåŒ–
    vi.spyOn(TokenManager.prototype, 'getIdToken').mockResolvedValue('mock-token');
  });

  /**
   * TC-NORMAL-001: getCompanyInfo() - codeã®ã¿æŒ‡å®šï¼ˆåŸºæœ¬çš„ãªä¼æ¥­æƒ…å ±+æœ€æ–°æ ªä¾¡å–å¾—ï¼‰ğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰æŒ‡å®šã§ä¼æ¥­æƒ…å ±ï¼ˆåç§°ã€å¸‚å ´ã€æ¥­ç¨®ï¼‰ã¨æœ€æ–°æ ªä¾¡ã‚’çµ±åˆã—ã¦å–å¾—ã§ãã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='7203'ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—ã€ä¼æ¥­æƒ…å ±ã¨æœ€æ–°æ ªä¾¡ãŒçµ±åˆã•ã‚Œã¦è¿”å´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: JQuantsClient.getListedInfo()ã¨getDailyQuotes()ã‚’å‘¼ã³å‡ºã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã—ã¦CompanyInfoå½¢å¼ã§è¿”å´
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆè¦ä»¶å®šç¾©æ›¸ REQ-FUNC-001, REQ-FUNC-002, REQ-FUNC-003 ã‹ã‚‰ç¢ºå®šï¼‰
   */
  it('TC-NORMAL-001: getCompanyInfo() - codeã®ã¿æŒ‡å®š', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: JQuantsClientã®ãƒ¢ãƒƒã‚¯ã‚’æº–å‚™
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Šã®ä¼æ¥­æƒ…å ±ã¨æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒƒã‚¯
    // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: JQuantsClient.getListedInfo()ã¨getDailyQuotes()ãŒä¼æ¥­æƒ…å ±ã¨æ ªä¾¡ã‚’è¿”å´ã™ã‚‹ãƒ¢ãƒƒã‚¯
    const mockCompany: Company = {
      code: '7203',
      name: 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',
      market: Market.PRIME,
      sector: Sector.TRANSPORTATION_EQUIPMENT,
    };

    const mockPrices: StockPrice[] = [
      {
        code: '7203',
        date: '2025-10-29',
        open: 3000,
        high: 3100,
        low: 2950,
        close: 3050,
        volume: 1000000,
      },
    ];

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getListedInfo()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getListedInfo').mockResolvedValue([mockCompany]);

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getDailyQuotes()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getDailyQuotes').mockResolvedValue(mockPrices);

    // Whenï¼ˆå®Ÿè¡Œï¼‰: getCompanyInfo()ã‚’codeã®ã¿ã§å‘¼ã³å‡ºã—
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ä¼æ¥­æƒ…å ±+æœ€æ–°æ ªä¾¡å–å¾—å‡¦ç†ã®å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: code='7203'ã§ä¼æ¥­æƒ…å ±ã¨æœ€æ–°æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const result = await getCompanyInfo({ code: '7203' });

    // Thenï¼ˆæ¤œè¨¼ï¼‰: ä¼æ¥­æƒ…å ±ã¨æœ€æ–°æ ªä¾¡ãŒçµ±åˆã•ã‚Œã¦è¿”å´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€çµæœæ¤œè¨¼ã€‘: CompanyInfoã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å­˜åœ¨ã‚’ç¢ºèª
    expect(result).toHaveProperty('code'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.code).toBe('7203'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãŒå…¥åŠ›å€¤ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('name'); // ã€ç¢ºèªå†…å®¹ã€‘: nameãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.name).toBe('ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š'); // ã€ç¢ºèªå†…å®¹ã€‘: nameãŒä¼æ¥­åã¨ä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('market'); // ã€ç¢ºèªå†…å®¹ã€‘: marketãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.market).toBe(Market.PRIME); // ã€ç¢ºèªå†…å®¹ã€‘: marketãŒPrimeå¸‚å ´ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('sector'); // ã€ç¢ºèªå†…å®¹ã€‘: sectorãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.sector).toBe(Sector.TRANSPORTATION_EQUIPMENT); // ã€ç¢ºèªå†…å®¹ã€‘: sectorãŒè¼¸é€ç”¨æ©Ÿå™¨ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('latest_price'); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.latest_price).toBe(3050); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãŒæœ€æ–°æ—¥ã®closeå€¤ã§ã‚ã‚‹ã“ã¨ ğŸ”µ

    // ã€APIå‘¼ã³å‡ºã—ç¢ºèªã€‘: JQuantsClient.getListedInfo()ãŒæ­£ã—ãå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    expect(JQuantsClient.prototype.getListedInfo).toHaveBeenCalledTimes(1); // ã€ç¢ºèªå†…å®¹ã€‘: getListedInfo()ãŒ1å›ã ã‘å‘¼ã°ã‚Œã‚‹ã“ã¨ ğŸ”µ

    // ã€APIå‘¼ã³å‡ºã—ç¢ºèªã€‘: JQuantsClient.getDailyQuotes()ãŒæ­£ã—ãå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    expect(JQuantsClient.prototype.getDailyQuotes).toHaveBeenCalledTimes(1); // ã€ç¢ºèªå†…å®¹ã€‘: getDailyQuotes()ãŒ1å›ã ã‘å‘¼ã°ã‚Œã‚‹ã“ã¨ ğŸ”µ
    expect(JQuantsClient.prototype.getDailyQuotes).toHaveBeenCalledWith('7203'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å‘¼ã°ã‚Œã‚‹ã“ã¨ ğŸ”µ
  });

  /**
   * TC-NORMAL-002: getCompanyInfo() - æœ€æ–°æ ªä¾¡ãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¤‡æ•°æ—¥ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã€æœ€æ–°æ—¥ï¼ˆæ—¥ä»˜ãŒæœ€ã‚‚æ–°ã—ã„ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ãŒæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='7203'ã§è¤‡æ•°æ—¥ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒƒã‚¯ã€æœ€æ–°æ—¥ã®æ ªä¾¡ãŒè¿”å´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: getDailyQuotes()ãŒè¤‡æ•°æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã€æ—¥ä»˜é™é †ã§ã‚½ãƒ¼ãƒˆã€å…ˆé ­ãƒ‡ãƒ¼ã‚¿ã®closeå€¤ã‚’latest_priceã«è¨­å®š
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆè¦ä»¶å®šç¾©æ›¸ REQ-FUNC-002 ã¨ Phase 1ã‚¿ã‚¹ã‚¯å®šç¾©ã‹ã‚‰ç¢ºå®šï¼‰
   */
  it('TC-NORMAL-002: getCompanyInfo() - æœ€æ–°æ ªä¾¡ã®æ—¥ä»˜æ¤œè¨¼', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: ä¼æ¥­æƒ…å ±ã¨è¤‡æ•°æ—¥ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Šã®ä¼æ¥­æƒ…å ±ã¨ã€é †ä¸åŒã®è¤‡æ•°æ—¥ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒƒã‚¯
    // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: JQuantsClient.getListedInfo()ã¨getDailyQuotes()ãŒãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã™ã‚‹ãƒ¢ãƒƒã‚¯
    const mockCompany: Company = {
      code: '7203',
      name: 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',
      market: Market.PRIME,
      sector: Sector.TRANSPORTATION_EQUIPMENT,
    };

    // ã€æ—¥ä»˜é †ä¸åŒã®ãƒ‡ãƒ¼ã‚¿ã€‘: å®Ÿéš›ã®APIã¯ã‚½ãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€é †ä¸åŒã§ãƒ†ã‚¹ãƒˆ
    const mockPrices: StockPrice[] = [
      {
        code: '7203',
        date: '2025-10-27',
        open: 2900,
        high: 2980,
        low: 2850,
        close: 2950,
        volume: 900000,
      },
      {
        code: '7203',
        date: '2025-10-29', // æœ€æ–°æ—¥
        open: 3000,
        high: 3100,
        low: 2950,
        close: 3050, // æœ€æ–°æ ªä¾¡
        volume: 1000000,
      },
      {
        code: '7203',
        date: '2025-10-28',
        open: 2950,
        high: 3020,
        low: 2900,
        close: 3000,
        volume: 950000,
      },
    ];

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getListedInfo()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getListedInfo').mockResolvedValue([mockCompany]);

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getDailyQuotes()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getDailyQuotes').mockResolvedValue(mockPrices);

    // Whenï¼ˆå®Ÿè¡Œï¼‰: getCompanyInfo()ã‚’codeã§å‘¼ã³å‡ºã—
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ä¼æ¥­æƒ…å ±+æœ€æ–°æ ªä¾¡å–å¾—å‡¦ç†ã®å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: code='7203'ã§ä¼æ¥­æƒ…å ±ã¨æœ€æ–°æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆè¤‡æ•°æ—¥ã®ä¸­ã‹ã‚‰æœ€æ–°ã‚’æŠ½å‡ºï¼‰
    const result = await getCompanyInfo({ code: '7203' });

    // Thenï¼ˆæ¤œè¨¼ï¼‰: æœ€æ–°æ—¥ã®æ ªä¾¡ãŒæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€çµæœæ¤œè¨¼ã€‘: latest_priceãŒæœ€æ–°æ—¥ï¼ˆ2025-10-29ï¼‰ã®closeå€¤ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(result.latest_price).toBe(3050); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãŒæœ€æ–°æ—¥ï¼ˆ2025-10-29ï¼‰ã®closeå€¤3050ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(result.latest_price).not.toBe(2950); // ã€ç¢ºèªå†…å®¹ã€‘: å¤ã„æ—¥ä»˜ï¼ˆ2025-10-27ï¼‰ã®closeå€¤2950ã§ãªã„ã“ã¨ ğŸ”µ
    expect(result.latest_price).not.toBe(3000); // ã€ç¢ºèªå†…å®¹ã€‘: å¤ã„æ—¥ä»˜ï¼ˆ2025-10-28ï¼‰ã®closeå€¤3000ã§ãªã„ã“ã¨ ğŸ”µ
  });
});

// =========================================
// ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ3ä»¶ï¼‰
// =========================================
describe('get-company-info.ts - ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã€ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ãƒªã‚»ãƒƒãƒˆ
    vi.clearAllMocks();

    // ã€ç’°å¢ƒå¤‰æ•°è¨­å®šã€‘: TokenManagerãŒå¿…è¦ã¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
    process.env.JQUANTS_REFRESH_TOKEN = 'test-refresh-token';

    // ã€TokenManagerãƒ¢ãƒƒã‚¯ã€‘: TokenManagerã®getIdTokenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(TokenManager.prototype, 'getIdToken').mockResolvedValue('mock-token');
  });

  /**
   * TC-ERROR-001: getCompanyInfo() - codeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœªæŒ‡å®šğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ code ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã«ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿{}ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆè¦ä»¶å®šç¾©æ›¸ REQ-VAL-001 ã¨æ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç¢ºå®šï¼‰
   * ã€ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¬ å¦‚
   * ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¶³ã‚’æ—©æœŸã«æ¤œå‡º
   */
  it('TC-ERROR-001: getCompanyInfo() - codeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœªæŒ‡å®š', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: codeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã¾ãªã„ç©ºã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: codeæœªæŒ‡å®šã®ä¸æ­£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    // ã€ä¸æ­£ãªç†ç”±ã€‘: codeã¯å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„
    // ã€å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ªã€‘: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã›ãšã«ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ãŸå ´åˆ
    const params = {};

    // When & Thenï¼ˆå®Ÿè¡Œã¨æ¤œè¨¼ï¼‰: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: codeæœªæŒ‡å®šã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
    // ã€çµæœæ¤œè¨¼ã€‘: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
    await expect(getCompanyInfo(params)).rejects.toThrow(ValidationError); // ã€ç¢ºèªå†…å®¹ã€‘: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ ğŸ”µ
    await expect(getCompanyInfo(params)).rejects.toThrow(
      'å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ code ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“'
    ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ã„ã“ã¨ ğŸ”µ

    // ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã€‘: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’äº‹å‰ã«é˜²æ­¢
  });

  /**
   * TC-ERROR-002: getCompanyInfo() - ä¸æ­£ãªcodeå€¤ğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: 4æ¡æ•°å­—ä»¥å¤–ã®codeãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã«ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='123'ï¼ˆ3æ¡ï¼‰ã€code='12345'ï¼ˆ5æ¡ï¼‰ã€code='ABCD'ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‰ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆè¦ä»¶å®šç¾©æ›¸ REQ-VAL-002 ã¨æ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç¢ºå®šï¼‰
   * ã€ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦ã€‘: ä¸æ­£ãªcodeãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   * ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§ã€‘: ä¸æ­£ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã®APIå‘¼ã³å‡ºã—ã‚’é˜²ã
   */
  it('TC-ERROR-002: getCompanyInfo() - ä¸æ­£ãªcodeå€¤', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: ä¸æ­£ãªcodeå€¤ã‚’æº–å‚™
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 3æ¡ã€5æ¡ã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®ä¸æ­£ãªcode
    // ã€ä¸æ­£ãªç†ç”±ã€‘: codeã¯4æ¡ã®æ•°å­—ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    // ã€å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ªã€‘: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª¤ã£ãŸå½¢å¼ã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ãŸå ´åˆ
    const invalidCodes = [
      { code: '123', reason: '3æ¡' },
      { code: '12345', reason: '5æ¡' },
      { code: 'ABCD', reason: 'ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ' },
    ];

    // When & Thenï¼ˆå®Ÿè¡Œã¨æ¤œè¨¼ï¼‰: ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    for (const { code, reason } of invalidCodes) {
      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ä¸æ­£ãªcodeã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
      // ã€çµæœæ¤œè¨¼ã€‘: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
      await expect(getCompanyInfo({ code })).rejects.toThrow(ValidationError); // ã€ç¢ºèªå†…å®¹ã€‘: ValidationErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ (${reason}) ğŸ”µ
      await expect(getCompanyInfo({ code })).rejects.toThrow(
        'éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã¯4æ¡ã®æ•°å­—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™'
      ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ã„ã“ã¨ (${reason}) ğŸ”µ
    }

    // ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã€‘: ä¸æ­£ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã®APIå‘¼ã³å‡ºã—ã‚’é˜²ã
  });

  /**
   * TC-ERROR-003: getCompanyInfo() - å­˜åœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å½¢å¼ã¯æ­£ã—ã„ãŒå®Ÿåœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã«ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='9999'ï¼ˆå­˜åœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼‰ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆPhase 1ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹5ã¨æ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç¢ºå®šï¼‰
   * ã€ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦ã€‘: å®Ÿåœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰
   * ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§ã€‘: å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é©åˆ‡ã«å‡¦ç†
   */
  it('TC-ERROR-003: getCompanyInfo() - å­˜åœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: å­˜åœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã§JQuantsClient.getListedInfo()ãŒç©ºé…åˆ—ã‚’è¿”ã™ãƒ¢ãƒƒã‚¯
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: JQuantsClient.getListedInfo()ãŒç©ºé…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯
    // ã€ä¸æ­£ãªç†ç”±ã€‘: éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰'9999'ã¯å®Ÿåœ¨ã—ãªã„
    // ã€å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ªã€‘: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª¤ã£ãŸéŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ãŸå ´åˆ
    vi.spyOn(JQuantsClient.prototype, 'getListedInfo').mockResolvedValue([]);

    // When & Thenï¼ˆå®Ÿè¡Œã¨æ¤œè¨¼ï¼‰: ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å­˜åœ¨ã—ãªã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
    // ã€çµæœæ¤œè¨¼ã€‘: ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
    await expect(getCompanyInfo({ code: '9999' })).rejects.toThrow(Error); // ã€ç¢ºèªå†…å®¹ã€‘: ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨ ğŸ”µ
    await expect(getCompanyInfo({ code: '9999' })).rejects.toThrow(
      'æŒ‡å®šã•ã‚ŒãŸéŠ˜æŸ„ã‚³ãƒ¼ãƒ‰'
    ); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã“ã¨ ğŸ”µ

    // ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã€‘: å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é©åˆ‡ã«å‡¦ç†
  });
});

// =========================================
// å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ2ä»¶ï¼‰
// =========================================
describe('get-company-info.ts - å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã€ãƒ¢ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ãƒªã‚»ãƒƒãƒˆ
    vi.clearAllMocks();

    // ã€ç’°å¢ƒå¤‰æ•°è¨­å®šã€‘: TokenManagerãŒå¿…è¦ã¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
    process.env.JQUANTS_REFRESH_TOKEN = 'test-refresh-token';

    // ã€TokenManagerãƒ¢ãƒƒã‚¯ã€‘: TokenManagerã®getIdTokenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(TokenManager.prototype, 'getIdToken').mockResolvedValue('mock-token');
  });

  /**
   * TC-BOUNDARY-001: getCompanyInfo() - æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ä¼æ¥­ğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ä¼æ¥­æƒ…å ±ã¯å­˜åœ¨ã™ã‚‹ãŒæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='8000'ï¼ˆæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: latest_priceãŒundefinedã§ä¼æ¥­æƒ…å ±ã®ã¿ãŒè¿”å´ã•ã‚Œã‚‹ã€ã¾ãŸã¯ErrorãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆPhase 1ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹6ã‹ã‚‰ç¢ºå®šï¼‰
   * ã€å¢ƒç•Œå€¤ã®æ„å‘³ã€‘: ä¼æ¥­æƒ…å ±ã¯å­˜åœ¨ã™ã‚‹ãŒæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å¢ƒç•Œã‚±ãƒ¼ã‚¹
   * ã€å¢ƒç•Œå€¤ã§ã®å‹•ä½œä¿è¨¼ã€‘: éƒ¨åˆ†çš„ãªãƒ‡ãƒ¼ã‚¿æ¬ æã«å¯¾ã™ã‚‹å …ç‰¢æ€§
   */
  it('TC-BOUNDARY-001: getCompanyInfo() - æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ä¼æ¥­', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: ä¼æ¥­æƒ…å ±ã¯å­˜åœ¨ã™ã‚‹ãŒæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ã‚±ãƒ¼ã‚¹ã‚’ãƒ¢ãƒƒã‚¯
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ä¼æ¥­æƒ…å ±ã¯è¿”å´ã•ã‚Œã‚‹ãŒã€æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã¯ç©ºé…åˆ—
    // ã€å¢ƒç•Œå€¤é¸æŠã®æ ¹æ‹ ã€‘: ä¼æ¥­æƒ…å ±ã¯å­˜åœ¨ã™ã‚‹ãŒæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ã‚±ãƒ¼ã‚¹
    // ã€å®Ÿéš›ã®ä½¿ç”¨å ´é¢ã€‘: IPOç›´å¾Œã§ã¾ã æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ä¼æ¥­
    const mockCompany: Company = {
      code: '8000',
      name: 'ãƒ†ã‚¹ãƒˆä¼æ¥­',
      market: Market.PRIME,
      sector: Sector.INFORMATION_COMMUNICATION,
    };

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getListedInfo()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getListedInfo').mockResolvedValue([mockCompany]);

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getDailyQuotes()ãŒç©ºé…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getDailyQuotes').mockResolvedValue([]);

    // Whenï¼ˆå®Ÿè¡Œï¼‰: getCompanyInfo()ã‚’æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãªã—ã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã§å‘¼ã³å‡ºã—
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ä¼æ¥­æƒ…å ±å–å¾—å‡¦ç†ã®å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: code='8000'ã§ä¼æ¥­æƒ…å ±ã‚’å–å¾—ï¼ˆæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰
    const result = await getCompanyInfo({ code: '8000' });

    // Thenï¼ˆæ¤œè¨¼ï¼‰: ä¼æ¥­æƒ…å ±ã¯è¿”å´ã•ã‚Œã€latest_priceã¯undefinedã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€çµæœæ¤œè¨¼ã€‘: æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å‡¦ç†çµæœã®æ¤œè¨¼
    expect(result.code).toBe('8000'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãŒä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.name).toBe('ãƒ†ã‚¹ãƒˆä¼æ¥­'); // ã€ç¢ºèªå†…å®¹ã€‘: nameãŒä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.market).toBe(Market.PRIME); // ã€ç¢ºèªå†…å®¹ã€‘: marketãŒä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.sector).toBe(Sector.INFORMATION_COMMUNICATION); // ã€ç¢ºèªå†…å®¹ã€‘: sectorãŒä¸€è‡´ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result.latest_price).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãŒundefinedã§ã‚ã‚‹ã“ã¨ ğŸ”µ

    // ã€å¢ƒç•Œã§ã®æ­£ç¢ºæ€§ã€‘: æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®å ´åˆã§ã‚‚ã€ä¼æ¥­æƒ…å ±ã¯æ­£ã—ãè¿”å´ã•ã‚Œã‚‹
    // ã€ä¸€è²«ã—ãŸå‹•ä½œã€‘: CompanyInfo å‹å®šç¾©ã«æº–æ‹ 
  });

  /**
   * TC-BOUNDARY-002: getCompanyInfo() - ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®Œå…¨æ€§ç¢ºèªğŸ”µ
   *
   * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: è¿”å´ãƒ‡ãƒ¼ã‚¿ãŒ CompanyInfo ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å«ã‚€ã“ã¨ã®ç¢ºèª
   * ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: code='7203'ã§getCompanyInfo()ã‚’å‘¼ã³å‡ºã—ã€å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å­˜åœ¨ã‚’ç¢ºèª
   * ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹
   * ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: é’ä¿¡å·ï¼ˆCompanyInfo å‹å®šç¾©ã¨Phase 1ã‚¿ã‚¹ã‚¯å®šç¾©ã‹ã‚‰ç¢ºå®šï¼‰
   * ã€å¢ƒç•Œå€¤ã®æ„å‘³ã€‘: è¿”å´ãƒ‡ãƒ¼ã‚¿ãŒ CompanyInfo ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å«ã‚€ã“ã¨ã®å¢ƒç•Œ
   * ã€å¢ƒç•Œå€¤ã§ã®å‹•ä½œä¿è¨¼ã€‘: éƒ¨åˆ†çš„ãªãƒ‡ãƒ¼ã‚¿ã§ã¯ãªãã€å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒè¿”å´ã•ã‚Œã‚‹
   */
  it('TC-BOUNDARY-002: getCompanyInfo() - ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®Œå…¨æ€§ç¢ºèª', async () => {
    // Givenï¼ˆå‰ææ¡ä»¶ï¼‰: å®Œå…¨ãªä¼æ¥­æƒ…å ±ã¨æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å«ã‚€ä¼æ¥­æƒ…å ±ã¨æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒƒã‚¯
    // ã€å¢ƒç•Œå€¤é¸æŠã®æ ¹æ‹ ã€‘: CompanyInfo ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæƒã£ã¦ã„ã‚‹æ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿ã§æ§‹é€ ã‚’æ¤œè¨¼
    // ã€å®Ÿéš›ã®ä½¿ç”¨å ´é¢ã€‘: ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã—ãŸåˆ†æ
    const mockCompany: Company = {
      code: '7203',
      name: 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',
      market: Market.PRIME,
      sector: Sector.TRANSPORTATION_EQUIPMENT,
    };

    const mockPrices: StockPrice[] = [
      {
        code: '7203',
        date: '2025-10-29',
        open: 3000,
        high: 3100,
        low: 2950,
        close: 3050,
        volume: 1000000,
      },
    ];

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getListedInfo()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getListedInfo').mockResolvedValue([mockCompany]);

    // ã€ãƒ¢ãƒƒã‚¯è¨­å®šã€‘: JQuantsClient.getDailyQuotes()ã‚’ãƒ¢ãƒƒã‚¯åŒ–
    vi.spyOn(JQuantsClient.prototype, 'getDailyQuotes').mockResolvedValue(mockPrices);

    // Whenï¼ˆå®Ÿè¡Œï¼‰: getCompanyInfo()ã‚’codeã§å‘¼ã³å‡ºã—
    // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ å–å¾—ã®å®Ÿè¡Œ
    // ã€å‡¦ç†å†…å®¹ã€‘: code='7203'ã§ä¼æ¥­æƒ…å ±ã¨æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const result = await getCompanyInfo({ code: '7203' });

    // Thenï¼ˆæ¤œè¨¼ï¼‰: ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®Œå…¨æ€§æ¤œè¨¼

    // ã€CompanyInfoå‹å®šç¾©ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèªã€‘
    expect(result).toHaveProperty('code'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('name'); // ã€ç¢ºèªå†…å®¹ã€‘: nameãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('market'); // ã€ç¢ºèªå†…å®¹ã€‘: marketãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('sector'); // ã€ç¢ºèªå†…å®¹ã€‘: sectorãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ
    expect(result).toHaveProperty('latest_price'); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãŒå­˜åœ¨ã™ã‚‹ã“ã¨ ğŸ”µ

    // ã€å‹ã®æ¤œè¨¼ã€‘
    expect(typeof result.code).toBe('string'); // ã€ç¢ºèªå†…å®¹ã€‘: codeãŒstringå‹ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(typeof result.name).toBe('string'); // ã€ç¢ºèªå†…å®¹ã€‘: nameãŒstringå‹ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(typeof result.market).toBe('string'); // ã€ç¢ºèªå†…å®¹ã€‘: marketãŒenumå€¤ï¼ˆstringå‹ï¼‰ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(typeof result.sector).toBe('string'); // ã€ç¢ºèªå†…å®¹ã€‘: sectorãŒenumå€¤ï¼ˆstringå‹ï¼‰ã§ã‚ã‚‹ã“ã¨ ğŸ”µ
    expect(typeof result.latest_price).toBe('number'); // ã€ç¢ºèªå†…å®¹ã€‘: latest_priceãŒnumberå‹ã§ã‚ã‚‹ã“ã¨ ğŸ”µ

    // ã€å¢ƒç•Œã§ã®æ­£ç¢ºæ€§ã€‘: ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
    // ã€ä¸€è²«ã—ãŸå‹•ä½œã€‘: CompanyInfo å‹å®šç¾©ã«å®Œå…¨ã«æº–æ‹ 
    // ã€TypeScript strict mode ã§ã®å‹å®‰å…¨æ€§ã€‘: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å‹ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨
  });
});
